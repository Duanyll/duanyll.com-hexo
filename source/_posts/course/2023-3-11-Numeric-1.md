---
title: æ•°å€¼åˆ†æä½œä¸š - æµ®ç‚¹è¿ç®—å’Œè¯¯å·®
tags:
  - æ•°å€¼åˆ†æ
---

## Problem 1

{% folding open:true è¯´æ˜ %}

åˆ†æå•ç²¾åº¦è®¡ç®— `fl(9.4)âˆ’fl(9)âˆ’fl(0.4)` çš„ç»“æœï¼Œå¹¶è¿›è¡Œè®¡ç®—æœºå®è·µã€‚

{% endfolding %}

|                  | Symbol | Exponent               | mantissa                   |
| ---------------- | ------ | ---------------------- | -------------------------- |
| `9.4f`           | + `0`  | 3 + 127 = `10000010`   | 1`00101100110011001100110` |
| `9.0f`           | + `0`  | 3 + 127 = `10000010`   | 1`00100000000000000000000` |
| `9.4f-9.0f`      | + `0`  | 3 + 127 = `10000010`   | 0`00001100110011001100110` |
| Lsh 5            | + `0`  | -2 + 127 = `01111101`  | 1`10011001100110011000000` |
| `0.4f`           | + `0`  | -2 + 127 = `01111101`  | 1`10011001100110011001101` |
| `9.4f-9.0f-0.4f` | - `1`  | -2 + 127 = `01111101`  | 0`00000000000000000001101` |
| Lsh 20           | - `1`  | -22 + 127 = `01101001` | 1`10100000000000000000000` |

å¾—åˆ°è®¡ç®—ç»“æœä¸º $-2^{-22}\times(1.101)_2\approx-0.000000387430$

ç¼–å†™è¾…åŠ©å‡½æ•°ç”¨äºè¾“å‡ºæµ®ç‚¹æ•°çš„æ¯”ç‰¹

```cpp
#define print_fpbits(x) print_fpbits_impl(x, #x)
template <typename T>
void print_fpbits_impl(T value, std::string expr) {
    auto y = reinterpret_cast<std::uint8_t*>(&value);
    std::cout << expr << ": " << std::endl;
    for (int i = sizeof(T) - 1; i >= 0; i--) {
        char byte = y[i];
        for (int j = 7; j >= 0; j--) {
            std::cout << ((byte >> j) & 1);
        }
    }
    std::cout << std::endl;
}
```

éªŒè¯è®¡ç®—è¿‡ç¨‹

```cpp
print_fpbits(9.4f);
print_fpbits(9.0f);
print_fpbits(0.4f);
print_fpbits(9.4f - 9.0f);
print_fpbits(9.4f - 9.0f - 0.4f);
std::cout << std::format("{:.12f}\n", 9.4f - 9.0f - 0.4f);
```

å¾—åˆ°è¾“å‡º

```
9.4f:
01000001000101100110011001100110
9.0f:
01000001000100000000000000000000
0.4f:
00111110110011001100110011001101
9.4f - 9.0f:
00111110110011001100110011000000
9.4f - 9.0f - 0.4f:
10110100110100000000000000000000
-0.000000387430
```

## Problem 2

{% folding open:true è¯´æ˜ %}

è®¾è®¡é«˜æ•ˆçš„å¤šé¡¹å¼ç®—æ³• $ğ‘ƒ(ğ‘¥)=1+2ğ‘¥^3+3ğ‘¥^7+4ğ‘¥^{11}+5ğ‘¥^{15}$, è®¡ç®—æœºç¼–ç¨‹æ¯”è¾ƒç›´æ¥ç®—æ³•ä¸ä¼˜åŒ–ç®—æ³•çš„è®¡ç®—æ—¶é—´ï¼ˆé‡‡ç”¨åŒç²¾åº¦è¿›è¡Œè®¡ç®—ï¼Œ$ğ‘¥=2,ğ‘¥=2.222222$åˆ†åˆ«å¾ªç¯ $10^9$ æ¬¡ï¼‰

{% endfolding %}

å®¹æ˜“å†™å‡ºç›´æ¥çš„ $O(n^2)$ å¤šé¡¹å¼è®¡ç®—æ–¹æ³•

```cpp
const double coef[] = {1, 0, 0, 2, 0, 0, 0, 3, 0, 0, 0, 4, 0, 0, 0, 5};

double pow_naive(double x, int n) {
    double res = 1.0;
    for (int i = 1; i <= n; i++) {
        res *= x;
    }
    return res;
}

double f_naive(double x) {
    double res = 0.;
    for (int i = 0; i <= 15; i++) {
        res += coef[i] * pow_naive(x, i);
    }
    return res;
}
```

å’Œç®€å•çš„ $O(n)$ ä¼˜åŒ–

```cpp
double f_fast(double x) {
    double res = 0.;
    double pow = 1.;
    for (int i = 0; i <= 15; i++) {
        res += coef[i] * pow;
        pow *= x;
    }
    return res;
}
```

éœ€è¦æ³¨æ„çš„æ˜¯, é’ˆå¯¹ C++ ä¸€ç±»ç¼–è¯‘å™¨å…·æœ‰å¼ºå¤§é™æ€ä¼˜åŒ–èƒ½åŠ›çš„ç¼–ç¨‹è¯­è¨€, å°†ç®€å•çš„ç®—æ³•åœ¨åŒæ ·çš„è¾“å…¥ä¸‹å•çº¯åœ°é‡å¤è¿è¡Œå¹¶ä¸æ˜¯åˆç†çš„æ€§èƒ½æµ‹é‡æ–¹å¼, å› ä¸ºç¼–è¯‘å™¨å¾ˆå®¹æ˜“å°†æ•´ä¸ªå¾ªç¯åˆ é™¤æ‰. ç®€å•èµ·è§, å¯ä»¥åœ¨å¾ªç¯ä¸­è¦æ±‚ä» `std::vector` ä¸­è¯»å–å¹¶å­˜å‚¨æ•°æ®, ä»¥é˜²æ­¢æ— ç”¨çš„å¾ªç¯è¢«åˆ é™¤. ä¸‹é¢æŠ¥å‘Šç¨‹åºåœ¨ `MSVC 19.33.31629.0` ä¸‹, ç®€å•å¾ªç¯ $10^7$ æ¬¡çš„ç”¨æ—¶

```
x = 2, naive: 2272.14ms
x = 2, fast: 418.473ms
x = 2.22... naive: 2245.62ms
x = 2.22..., fast: 426.92ms
```

å¯ç”¨ `/O2` ä¼˜åŒ–å, æ€§èƒ½æœ‰æ˜¾è‘—çš„æå‡

```
x = 2, naive: 686.996ms
x = 2, fast: 113.86ms
x = 2.22... naive: 670.233ms
x = 2.22..., fast: 108.462ms
```

## Problem 3

{% folding open:true è¯´æ˜ %}

æ¨å¯¼è®¡ç®— $ğ¼_ğ‘›=\int_0^1 ğ‘¥^ğ‘› ğ‘’^ğ‘¥\d ğ‘¥$ çš„é€’æ¨å…¬å¼,ç”¨æ­£å‘å’Œé€†å‘é€’æ¨è®¡ç®— $ğ¼_0~ğ¼_20$ï¼Œæ¯”è¾ƒå¹¶åˆ†æä¸¤ç§è¿­ä»£çš„è¯¯å·®å’Œç¨³å®šæ€§ã€‚

{% endfolding %}

å®¹æ˜“æ¨å¯¼å…¬å¼

$$
\begin{aligned}
    ğ¼_ğ‘›&=\int_0^1 ğ‘¥^ğ‘› ğ‘’^ğ‘¥\d ğ‘¥\\
       &=\int_0^1x^n\d e^x\\
       &=(x^ne^x)\Big|_{x=0}^1-\int_0^1e^x\d x^n\\
       &=e-nI_{n-1}
\end{aligned}
$$

åˆå§‹å€¼å¯ä»¥å–

$$
I_1=1
$$

è¿™ä¸ªæ­£å‘é€’æ¨å…¬å¼æ¯æ¬¡é€’æ¨å°†è¯¯å·®æ”¾å¤§äº”å€

```mathematica
forward = (NestList[{E - #[[2]] #[[1]], #[[2]] + 1} &, {1., 2}, 20] // Transpose)[[1]];
forward // InputForm
```

```mathematica
{1., 0.7182818284590451, 0.5634363430819098,
 0.4645364561314058, 0.395599547802016, 0.34468454164694906,
 0.30549003693040166, 0.27436153301583177, 0.24902803131655915,
 0.22800151529345358, 0.21026516023105568, 0.19509990568637692,
 0.18198305453614516, 0.17051906495301283, 0.1604958541638526,
 0.15034816183740363, 0.16236307722318344, -0.2042535615582568,
 6.599099498065924, -129.26370813285942, 2717.256152618507}
```

æ³¨æ„åˆ°åœ¨ 16 é¡¹å¤„ç”±äºè¯¯å·®çš„ç´¯ç§¯å¯¼è‡´ç§¯åˆ†æœ‰ç•Œæ€§å·²è¢«ç ´å, ä¹‹åçš„è¿­ä»£è¿‡ç¨‹æ˜æ˜¾ä¸æ”¶æ•›.

è€ƒè™‘åå‘è¿­ä»£å…¬å¼

$$
I_{n-1}=\frac{1}{n}(e-I_n)
$$

å– $I_{30}=1$ åå‘è¿­ä»£

```mathematica
backward = (NestList[{1/#[[2]] (E - #[[1]]), #[[2]] - 1} &, {1., 30},
      29] // Transpose)[[1]] // Reverse;
backward // InputForm
```

```mathematica
{1., 0.7182818284590452, 0.5634363430819095,
 0.4645364561314071, 0.3955995478020096, 0.3446845416469873,
 0.30549003693013366, 0.27436153301797606, 0.24902803129726034,
 0.2280015154864418, 0.21026515810818536, 0.19509993116082064,
 0.18198272336837695, 0.17052370130176742, 0.16042630893253398,
 0.15146088553850115, 0.14344677430452524, 0.13623989097759062,
 0.12972389988482333, 0.12380383076257832, 0.11840138244490007,
 0.1134514146712435, 0.10889929102044421, 0.10469884396838404,
 0.10081072924944416, 0.09720286797349674, 0.09380439317463288,
 0.09175881956932448, 0.057276060948634834, 1.}
```

ä¸ `NIntegrate` ç›´æ¥ç§¯åˆ† (ä¿è¯ 20 ä½æœ‰æ•ˆæ•°å­—) çš„ç»“æœæ¯”è¾ƒå¹¶ç»˜åˆ¶å›¾åƒ

```mathematica
direct =
 Table[NIntegrate[x^n E^x, {x, 0, 1}, AccuracyGoal -> 20,
   WorkingPrecision -> 20], {n, 1, 20}];
ListLinePlot[{forward, backward, direct}]
```

![](https://img.duanyll.com/img/20230312161016.png)

ç»˜åˆ¶ä¸¤ç§ç®—æ³•å’Œç›´æ¥æ•°å€¼ç§¯åˆ†æ³•çš„æ®‹å·®

```mathematica
ListLinePlot[
 Abs[{Take[forward, 20] - direct, Take[backward, 20] - direct}]]
```

![](https://img.duanyll.com/img/20230312161441.png)

ç”±äºåå‘è¿­ä»£é€æ¸å‡å°è¯¯å·®çš„ç‰¹æ€§, è¡¨ç°è¿œå¥½äºæ­£å‘è¿­ä»£
