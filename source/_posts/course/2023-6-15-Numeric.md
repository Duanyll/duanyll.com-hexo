---
title: 数值分析速通
tags:
  - 数值分析
---

## 误差

准确值 $x^*$, 近似值 $x$

- 绝对误差 $e(x)=x-x^*$
- 相对误差 $e(x)=(x-x^*)/x^*$
- $$
  e(x\pm y)=e(x)\pm e(y)
  $$ 
  相近的数相减, 相对误差增大
- $$
  e(xy)=ye(x)+x^*e(y)
  $$
- $$
  e(\frac{x}{y})=\frac{ye(x)-xe(y)}{yy^*}
  $$
  小数做除数, 绝对误差增大

数值计算的基本原则

- 避免绝对值小的数做除数
- 防止大数吃小数 (数量级相差大的数相加减)
- 避免相近的数相减
- 减少 Flops

## 非线性求解方程

### 二分法

![二分法伪代码](https://cdn.duanyll.com/img/20230617100739.png)

### 不动点迭代

![不动点迭代伪代码](https://cdn.duanyll.com/img/20230617100816.png)


$$
\lim_{i\to\infty}x_i=r,g(r)=g(\lim_{i\to\infty}x_i)=\lim_{i\to\infty} g(x_i)=\lim_{i\to\infty}x_{i+1}=r
$$

定义, 全局收敛, 局部收敛, [Lipschitz 收敛](/source/_posts/course/2023-2-7-Calculus-1.md#压缩映射原理)

推论: $g(x)$ 在 $[a,b]$ 连续, $(a,b)$ 可微, $\forall x\in[a,b],a\leq g(x)\leq b$, $\exist L\in(0,1)$

$$
|g'(x)|\leq L
$$

$\implies g(x)$ 在 $[a,b]$ 上存在唯一不动点

**局部收敛定理**: $|g'(x^*)|<1\implies x_{i+1}=g(x_i)$ 局部收敛

> $|g'(x^*)|$ 越接近零, 则不动点迭代收敛越快. $|g'(x^*)|=0$ 时将具有更高的收敛阶.

### 精度的极限

![精度的极限](https://cdn.duanyll.com/img/20230617103102.png)

- 前向误差: 迭代点值不准确 $|x_n|-r$
- 后向误差: 迭代公式计算不准确 (如存在浮点误差) $f(x_n)$
- 误差放大因子: 相对前向误差 / 相对后向误差
- 条件数: 问题本身所决定的误差放大

原问题:

$$
f(x)=0\implies x=r
$$

有误差的问题

$$
f(x)+\epsilon g(x)=0\implies x=r+\Delta r
$$

{% folding open:true 说明 %}

$$
f(r+\Delta r)+\epsilon g(r+\Delta r)=0
$$

Taylor 展开

$$
f(r)+(\Delta r)f'(r)+\epsilon g(r)+\epsilon(\Delta r)g'(r)+O((\Delta r)^2)
$$

$$
(\Delta r)(f'(r)+\epsilon g'(r))\approx-f(r)-\epsilon g(r)=\epsilon g(r)
$$

{% endfolding %}

得到**根的敏感公式**:

$$
\Delta r\approx\frac{-\epsilon g(r)}{f'(r)+\epsilon g'(r)}\approx-\epsilon\frac{g(r)}{f'(r)}
$$

误差放大因子

$$
\left|\frac{\Delta r/r}{\epsilon g(r)/g(r)}\right|=\left|\frac{g(r)}{rf'(r)}\right|
$$

> 要探讨迭代公式中某一项造成的误差, 就把这一项代入 $g(x)$

### 牛顿迭代法

是一种特殊形式的不动点迭代, 希望提高迭代的[收敛阶](/source/_posts/course/2022-12-06-Optim-4.md#收敛阶), 构造不动点迭代使得

$$
g'(x^*)=0
$$

迭代公式 (切线近似):

$$
x_{i+1}=x_i-\frac{f(x_i)}{f'(x_i)}
$$

**二阶收敛** $f(r)=0,f'(r)\neq0,f''(r)\neq0$, 则牛顿法局部二次收敛, 迭代误差 $e_i=|x_i-r|$ 满足

$$
\lim_{i\to\infty}\frac{e_{i+1}}{e_i^2}=\left|\frac{f''(r)}{2f'(r)}\right|
$$

[更高阶收敛的情形](/source/_posts/course/2023-3-18-Numeric-2.md#problem-2)

**线性收敛** $m$ 重根 $f(r)=f'(r)=\cdots=f^{(m-1)}(r)=0$

$$
\lim_{i\to\infty}\frac{e_{i+1}}{e_i}=\frac{m-1}{m}
$$

**改进为局部二次收敛** $m$ 重根且 $f^{(m+1)}(r)\neq 0$, 使用迭代公式

$$
x_{i+1}=x_i-\frac{mf(x_i)}{f'(x_i)}
$$

局部二次收敛

$$
\lim_{i\to\infty}\frac{e_{i+1}}{e_i^2}=\frac{1}{m(m+1)}\left|\frac{f^{(m+1)}(r)}{f^{(m)}(r)}\right|
$$

![牛顿下山法](https://cdn.duanyll.com/img/20230617111425.png)

推广到非线性方程组

$$
X_{i+1}=X_i-J^{-1}(X_i)F(X_i)
$$

## 线性方程组的直接解法

### 高斯消元

![高斯消元](https://cdn.duanyll.com/img/20230617115549.png)

得到左侧上三角阵, 回代求解. 消元复杂度 $O(n^3)$, 回代复杂度 $O(n^2)$

### LU 分解

![](https://cdn.duanyll.com/img/20230617120152.png)

LU 分解不唯一, 可规定对角线上元素为 1

![](https://cdn.duanyll.com/img/20230617120257.png)

![](https://cdn.duanyll.com/img/20230617120343.png)

![伪代码](https://cdn.duanyll.com/img/20230617120510.png)

LU 分解定理: $A^{n\times n}$ 的前 $n$ 个主子式非奇异, 则有 LU 分解 (那不就是可逆吗)

### 误差

算子范数

- $\|A\|_1=\max_j(|a_{1j}|+\cdots|a_{nj}|)$ 最大绝对列和
- $\|A\|_2=\sqrt{\rho(A^\top A)}$, $A^\top A$ 的谱半径 (特征值最大模) 的平方根
- $\|A\|_\infty=\max_i(|a_{i1}|+\cdots|a_{in}|)$ 最大绝对行和

求解 $Ax=b$ 的误差

- 近似解 $x_a$ 的前向误差 $\|x_a-x\|_\infty$
- 后向误差 $\|b-Ax_a\|=\|r\|_\infty$
- 误差放大因子
  $$
  \frac{\|x_a-x\|_\infty/\|x\|_\infty}{\|r\|_\infty/\|b\|_\infty}
  $$
- 条件数: 求解 $Ax=b$ 时对于所有 $b\neq0$ 可能出现的最大误差放大因子
  $$
  \operatorname{cond}(A)=\max_{b\in\R^n,b\neq0}\frac{\|x_a-x\|_\infty/\|x\|_\infty}{\|r\|_\infty/\|b\|_\infty}
  $$

定理: 可逆方阵的条件数为

$$
\operatorname{cond}(A)=\|A\|_\infty\|A^{-1}\|_\infty
$$

前向和后向误差满足

$$
\frac{1}{\operatorname{cond}(A)}\frac{\|r\|_\infty}{\|b\|_\infty}\leq\frac{\|x_a-x\|_\infty}{\|x\|_\infty}\leq\operatorname{cond}(A)\frac{\|r\|_\infty}{\|b\|_\infty}
$$

![淹没现象](https://cdn.duanyll.com/img/20230617143744.png)

![列主消元](https://cdn.duanyll.com/img/20230617143810.png)

### 联系

顺序高斯消元

$$
E_m\cdots E_1 A=U\iff A=E_1^{-1}\cdots E_m^{-1}U
$$

$$
E_1^{-1}\cdots E_m^{-1}=L
$$

顺序高斯消元后, 左侧的上三角阵为 $U$, 右侧从 $I$ 开始变换, 逆为 $L$

列主高斯消元增加 $P$ 矩阵

$$
P_{n-1}\cdots P_1A=LU\implies PA=LU,P=P_{n-1}\cdots P_1
$$

$$
Ax=b\implies PAx=Pb\implies LUx=Pb\implies\begin{cases}
  Ly=Pb\\
  Ux=y
\end{cases}
$$

严格行对角占优矩阵: 对角线元素比这一行其他元素加起来大

$$
|a_{ii}|>\sum_{j=1,j\neq i}^n|a_{ij}|
$$

定理：不选主元Gauss消元法保持矩阵的严格行对角占优性质

推论：行对角占优矩阵非奇异且有 LU 分解

## 线性方程组的迭代法

$$
Ax=b\implies Qx_{k+1}=(Q-A)x_k+b
$$

$Q$ 称为分裂矩阵, 写成不动点迭代形式

$$
x_{k+1}=(I-Q^{-1}A)x_k+Q^{-1}b
$$

迭代矩阵

$$
G=(I-Q^{-1}A)
$$

不同的迭代方法的区别为构造了不同的 $Q$ 和 $G$. $Q^{-1}$ 和 $G$ 应当容易计算.

![](https://cdn.duanyll.com/img/20230617161344.png)

![](https://cdn.duanyll.com/img/20230617161803.png)

![](https://cdn.duanyll.com/img/20230617161857.png)

### Richardson 迭代

$$
Q=I,G=I-A
$$

$$
x_{k+1}=(I-A)x_k+b
$$

$A$ 是单位严格行 / 列对角占优矩阵时收敛 (主对角线全为 1)

### Jacobi 迭代

$$
Q=D,G=-D^{-1}(L+U)
$$

$$
x_{k+1}=-D^{-1}(L+U)x_k+D^{-1}b
$$

![D, L, U 是 A 的部分](https://cdn.duanyll.com/img/20230617160122.png)

$A$ 是严格行对角占优矩阵时收敛

### Gauss-Seidel 迭代

$$
Q=D+L, G=-(D+L)^{-1}U
$$

$$
x_{k+1}=-(D+L)^{-1}Ux_k+(D+L)^{-1}b
$$

$A$ 是严格行对角占优矩阵时收敛

主对角元非零收敛

### SOR 迭代

$$
x_{k+1}=Gx_k+c
$$

添加 "动量" 项

$$
x_{k+1}=\gamma(Gx_k+c)+(1-\gamma)x_k
$$

即

$$
x_{k+1}=G_\gamma x_k+\gamma c,G_\gamma=\gamma G+(1-\gamma)I
$$

Gauss-Seidel 迭代推广到 SOR 迭代形式

$$
x_{k+1}=(1-\omega)x_k+\omega D^{-1}(b-Ux_k-Lx_{k+1})
$$

$$
Q=\frac{1}{\omega}(D+\omega L)
$$

$$
G=(D+\omega L)^{-1}((1-\omega)D-\omega U)
$$

- $\omega < 1$ 欠松弛
- $\omega = 1$ Gauss-Seidel
- $\omega > 1$ 超松弛

需要实验确定收敛最快的 $\omega$

主对角元非零, $0<\omega<2$ 收敛

## 对称正定线性方程组的解法

若 $A$ 是对称正定矩阵，则求解 $Ax=b$ 的 SOR 迭代对于任意初始向量收敛。

### Cholesky 分解

实对称正定矩阵可以分解为 $A=LL^\top$, $L$ 是下三角阵

![](https://cdn.duanyll.com/img/20230617162838.png)

![](https://cdn.duanyll.com/img/20230617163042.png)

![伪代码](https://cdn.duanyll.com/img/20230617163412.png)

### 梯度下降法

$A$ 对称正定, 则求解 $Ax=b$ 等价于 极小化二次型问题

$$
\argmin_{x\in\R^n}q(x)=\frac{1}{2}\left<x,Ax\right>-\left<x,b\right>
$$

其中 $\left<x,y\right> =x^\top y$ 

[梯度下降法](/source/_posts/course/2022-12-06-Optim-4.md#梯度下降法)迭代公式.

### 共轭梯度法

[迭代公式](/source/_posts/course/2022-12-06-Optim-4.md#共轭梯度法)

## 矩阵特征值的数值解法

通过高次多项式求根解特征值是病态问题, 需要更好的方法

### 盖尔圆盘

通过盖尔圆盘可估计特征值的大概范围

**盖尔(Gershgorin)圆盘定理**：方阵 $A$ 的谱（特征值集）包含在下列复平面中 $n$ 个圆盘 $C_i$ 的并中

$$
C_i=\left\{z\in\mathbb{C}:|z-a_{ii}|\leq\sum_{j=1,j\neq i}^n|a_{ij}|\right\}(1\leq i\leq n)
$$

{% folding open:true 说明 %}

$$
Ax=\lambda x
$$

对 $x$ 的每一个分量 $x_i$

$$
\sum_{j=1}^na_{ij}x_j=\lambda x_i
$$

$$
(\lambda-a_{ii})x_i=\sum_{j=1,j\neq i}^na_{ij}x_j
$$

$$
|\lambda-a_{ii}|\leq\sum_{j=1,j\neq i}^na_{ij}\frac{|x_j|}{|x_i|}
$$

{% endfolding %}

圆心是对角线元素, 半径是每一行的和. $A^\top$ 特征值与 $A$ 相同, 对于列也有

$$
D_i=\left\{z\in\mathbb{C}:|z-a_{ii}|\leq\sum_{k=1,k\neq i}^n|a_{ki}|\right\}(1\leq i\leq n)
$$

则特征值位于 $C_i$ 的并交 $D_i$ 的并中

**盖尔(Gershgorin)圆盘第二定理**：设方阵 $A$ 的 $n$ 个盖尔圆盘分成若干个连通区域，若一个连通区域含有 $k$ 个盖尔圆盘，则有且只有 $k$ 个特征值落在这个连通区域内（若两个盖尔圆盘重合，需计重数；又若特征值为重根也需计重数）

- 推论1：严格对角占优矩阵可逆。
- 推论2：方阵的 $n$ 个盖尔圆盘两两互不相交，则相似于对角阵。
- 推论3：实方阵的 $n$ 个盖尔圆盘两两互不相交，则特征值全为实数。

**扰动矩阵特征值圆盘定理**：若 $n$ 阶方阵 $A$ 用相似变换 $P^{−1}AP$ 对角化，而 $B$ 是任意 $n$ 阶方阵，则 $A+B$ 的特征值 $\mu$ 位于下列圆盘之并中：

$$
\{\mu\in\mathbb{C}:|\mu-\lambda_i|\leq\operatorname{cond}_\infty(P)\|B\|_\infty\}
$$

通过条件数估计特征值偏离的范围.

### 幂法

将矩阵反复作用于一个向量, 最终方向会接近于矩阵的一个特征向量. 将向量 $x$ 用特征向量 $v_1,\cdots,v_n$ 作为基表出, 迭代公式

$$
\begin{aligned} 
  x_k=A^kx_0&=A^k(c_1v_1+\cdots+c_nv_n)\\
  &=\lambda_1^k\left(c_1v_1+\left(\frac{\lambda_2}{\lambda_1}\right)^kc_2v_2+\cdots+\left(\frac{\lambda_n}{\lambda_1}\right)^kc_nv_n\right)
\end{aligned}
$$

当 $|\lambda_1|>|\lambda_2|\geq\cdots\geq|\lambda_n|$ 时, 有

$$
\lim_{k\to\infty}x_k=\lim_{k\to\infty}\lambda_1^k\left(c_1v_1+\left(\frac{\lambda_2}{\lambda_1}\right)^kc_2v_2\right)
$$

特征向量

$$
v_1\approx x_k
$$

特征值

$$
\lambda_1\approx r_k=\frac{x_k^{(i)}}{x_{k-1}^{(i)}}
$$

线性收敛率 $S\leq|\lambda_2/\lambda_1|$

若最大特征值是两重, $|\lambda_1|=|\lambda_2|>|\lambda_3|\geq\cdots\geq|\lambda_n|$, $\lambda_1=-\lambda_2$

$$
\lim_{k\to\infty}x_k=\lim_{k\to\infty}\lambda_1^k\left(c_1v_1+(-1)^kc_1v_1+\left(\frac{\lambda_3}{\lambda_1}\right)^kc_3v_3\right)
$$

特征值

$$
x_k\approx\lambda_1^2x_{k-2}\implies \lambda_1^2\approx\frac{x_k^{(i)}}{x_{k-2}^{(i)}}
$$

特征向量

![](https://cdn.duanyll.com/img/20230617232749.png)

通过以上方法求出模长最大的特征向量. 求解其他特征向量

- 模长最小: $x_{k+1}=A^{-1}x_k$
- 离 $\mu$ 最远: $x_{k+1}=(A-\mu I)x_k$
- 离 $\mu$ 最近: $(A-\mu I)x_{k+1}=x_k$

### Rayleigh 商迭代

已知近似特征向量 $x$, 求解超定方程

$$
Ax\approx\lambda x
$$

最小化残差 Rayleigh 商

$$
\lambda=\frac{x^\top Ax}{x^\top x}
$$

![](https://cdn.duanyll.com/img/20230617233820.png)

### QR 分解

把 $A^{m\times n}$ 分解为 $A=QR$, $Q$ 是正交阵, $R$ 是上三角阵

- 消减 QR 分解: $A^{m\times n}=Q^{m\times n}R^{n\times n}$ ($A$ 的列向量不够多, 没有求出完整的正交基)
- 完全 QR 分解: $A^{m\times n}=Q^{m\times m}R^{m\times n}$ (任意补充 $m-n$ 个向量得到完整正交基, $R$ 矩阵多余的部分补零)

#### Gram-Schmit 正交化

对 $A$ 的每个列向量, 依次减去与前面的向量平行的分量并归一化, 得到正交向量组作为 $Q$ 矩阵, 记录系数作为 $R$ 矩阵

![Gram-Schmit 正交化实现消减 QR 分解](https://cdn.duanyll.com/img/20230618110346.png)

![要实现完全 QR 分解, 先任意补充线性无关组](https://cdn.duanyll.com/img/20230618110611.png)

![R 矩阵下方补零](https://cdn.duanyll.com/img/20230618110711.png)

![](https://cdn.duanyll.com/img/20230618112219.png)

两种形式在数学上等价, 但如果因为数值计算的误差导致靠前的向量之间没有完全正交, 改进的方法仍然能尽量保持后面的向量之间的正交性.

时间复杂度: $O(mn^2)$

#### Householder 变换

![Householder 反射子定义](https://cdn.duanyll.com/img/20230618112711.png)

$$
H=I-2\frac{vv^\top}{v^\top v}
$$

则 $Hx$ 是 $x$ 关于超平面 $v^\perp$ 的镜像. 已知向量 $x$ 和 $w$ 满足 $\|x\|_2=\|w\|_2$, 可令 $v=w-x$ 求出 $H$ 使得 $w=Hx$

利用 Householder 变换实现 QR 分解, 方法是通过叠加多个 Householder 反射子得到 $Q$ 矩阵

$$
A=QR\implies Q^\top A=R\implies [Q^\top A_1,Q^\top A_2]=\begin{bmatrix}
  \square & \square \\
  0 & \square
\end{bmatrix}
$$

由 $R$ 矩阵的形式, 每增加 $A$ 中新的向量作为 $x$ 时, 可以容易得到对应的 $w$, 则可以求出 $H$.

![构造第一列的 w 并得到 H1](https://cdn.duanyll.com/img/20230618114309.png)

![后续只处理 Tilde A, 不需要处理 W, H 矩阵之前处理好的部分用 I 填充](https://cdn.duanyll.com/img/20230618115907.png)

$$
H_n\cdots H_1A=R\implies Q=H_1\cdots H_n
$$

![伪代码](https://cdn.duanyll.com/img/20230618120236.png)

Householder 变换直接得到的是完全 QR 分解, 数值稳定性比 GS 正交化好.

#### QR 算法

求出矩阵的所有特征值. 选取一组正交向量同时进行幂迭代，每次迭代都对向量进行正交化，最终可得到所有的特征向量及对应的特征值.

![](https://cdn.duanyll.com/img/20230618121857.png)

![伪代码](https://cdn.duanyll.com/img/20230618122001.png)

## 插值

插值问题的数学定义: $f(x)$ 为区间 $[a,b]$ 上的函数, $\{x_i\}_{i=0}^n$ 为 $[a,b]$ 上 $n+1$ 个互不相同的点 (插值结点),

$$
\Phi=\operatorname{span}\{\phi_0(x),\phi_1(x),\cdots,\phi(x)\}
$$

求 $g(x)\in\Phi$ 满足 $g(x_i)=f(x_i)$, $\phi_0(x),\phi_1(x),\cdots,\phi(x)$ 称为基函数. 不同插值方法的区别在于基函数的选取方式和插值结点的选取方式.

![给定基函数和插值结点, 可解线性方程组得到系数](https://cdn.duanyll.com/img/20230618160637.png)

### 基本多项式插值

很显然, 选取相同的插值结点, 多项式插值的 $g(x)$ 的符号结果都是相同的, 但不同的算法的数值精度和计算复杂度有差异.

#### 多项式插值

$$
\Phi=P_n(x)=\operatorname{span}\{1,x,\cdots,x^n\}
$$

![系数矩阵](https://cdn.duanyll.com/img/20230618161024.png)

形式简单, 但是系数矩阵条件数大

#### Lagrange 插值

构造一组多项式基函数 $\{l_i(x)\}$, 使得 $M$ 成为对角阵, 便于求解. 条件:

$$
l_i(x_j)=\begin{cases}
  0 & i\neq j\\
  1 & i=j
\end{cases}
$$

容易得到

$$
l_i(x)=\frac{(x-x_0)\cdots(x-x_{i-1})(x-x_{i+1})\cdots(x-x_n)}{(x_i-x_0)\cdots(x_i-x_{i-1})(x_i-x_{i+1})\cdots(x_i-x_n)}
$$

满足条件, $g(x)$ 可以简单取

$$
g(x)=\sum_{i=0}^n f(x_i)l_i(x)
$$

Lagrange 插值不用求解 $M$, 但此形式仍然计算复杂度较高.

#### Newton 插值

希望能够增量计算新的插值节点, 而不改变之前插值结点的系数, 方便计算. 选取基函数

$$
N_i(x)=(x-x_0)(x-x_1)\cdots(x-x_{i-1})
$$

![系数矩阵是下三角阵, 可直接回代求解](https://cdn.duanyll.com/img/20230618162709.png)

规定记号

$$
a_n\triangleq f[x_0,x_1,\cdots,x_n]
$$

为 $n$ 阶 Newton 差商, 则回代求解过程可如下表示

$$
f[x_0,x_1,\cdots,x_{n-1},x_n]=\frac{f[x_0,\cdots,x_{n-1}]-f[x_1,\cdots,x_n]}{x_n-x_0}
$$

![差商计算过程](https://cdn.duanyll.com/img/20230618163630.png)

![可以滚动数组优化内存](https://cdn.duanyll.com/img/20230618163815.png)

得到系数 $a_i$ 后, $g(x)$ 的计算可以使用秦九韶算法节约复杂度.

### Chebyshev 插值

#### Motivation

**多项式插值误差定理**: $f\in C^{n+1}[a,b]$, $P_n(x)$ 是 $[a,b]$ 上不超过 $n$ 次的插值多项式, 则 $\forall x\in[a,b]$

$$
\begin{aligned}
  f(x)-P_n(x)&=f[x_0,\cdots,x_n,x]\prod_{i=0}^n(x-x_i)\\
  &=\frac{1}{(n+1)!}f^{(n+1)}(c)\prod_{i=0}^n(x-x_i)
\end{aligned}
\label{interplError}
$$

其中 $c\in(a,b)$

> 这个形式显然是 Taylor 展开的 Lagrange 余项

![Runge 现象, 在区间的两端剧烈震荡](https://cdn.duanyll.com/img/20230618165919.png)

进行高次多项式插值的弊端, 高阶导数 $f^{(n+1)}(c)$ 可能巨大. 为了避免区间端点处的震荡, 可以向外拓展插值结点; 也可以通过合理选取插值结点, 尽量减小 $\prod_{i=0}^n(x-x_i)$ 项. Chebyshev 多项式给出的插值结点能最小化这一部分的误差.

#### 性质

第一类 $n$ 阶 Chebyshev 多项式:

$$
T_n(x)=\cos(n\arccos(x))
$$

![Chebyshev 多项式的性质](https://cdn.duanyll.com/img/20230618170438.png)

![Chebyshev 多项式的图像](https://cdn.duanyll.com/img/20230618170511.png)

![Chebyshev 多项式的零点均匀地分布在圆周上](https://cdn.duanyll.com/img/20230618170553.png)

$$
x_k=\cos\frac{(2k+1)\pi}{2n},k=0,1,\cdots n-1
$$


#### 证明

![Chebyshev 多项式是区间上值域最小的首一多项式](https://cdn.duanyll.com/img/20230618171446.png)

{% folding open:true 说明 %}

![](https://cdn.duanyll.com/img/20230618171659.png)

反证: 设首一多项式 $\tilde{P}(x)$ 比 $2^{1-n}T_n(x)$ 小, 则

$$
q(x)=\tilde{P}(x)-2^{1-n}T_n(x)
$$

是 $n-1$ 次多项式且有 $n$ 个零点, 则恒为零, $\tilde{P}(x)=2^{1-n}T_n(x)$

{% endfolding %}

在标准区间 $[-1,1]$ 上选取 Chebyshev 多项式的根作为插值结点, 误差满足

$$
\begin{aligned}
  |f(x)-P_n(x)|&=\frac{1}{(n+1)!}\left|f^{(n+1)}(c)\prod_{i=0}^n(x-x_i)\right|\\
  &=\frac{1}{(n+1)!}\left|f^{(n+1)}(c)\frac{T_{n+1}(x)}{2^n}\right|\\
  &\leq\frac{1}{2^n(n+1)!}\left|f^{(n+1)}(c)\right|
\end{aligned}
$$

把标准区间变换到任意区间 $[a,b]$

$$
x_i=\frac{b-a}{2}\cos\frac{(2k+1)\pi}{2(n+1)}+\frac{b+a}{2},k=0,1,\cdots n
$$

误差满足

$$
|f(x)-P_n(x)|\leq\frac{\left(\frac{b-a}{2}\right)^{n+1}}{2^n(n+1)!}\left|f^{(n+1)}(c)\right|
$$

### Hermite 插值

除了插值结点处的函数值, 把一阶导数值等也纳入插值方程. 需要根据选取的方程条件数量确定插值的次数, 防止无解或多解.

Hermite 插值定理：存在唯一的次数至多是 $m$ 的多项式 $P_m (x)$ 满足 $m+1$ 个Hermite 插值条件

只有一个插值结点, 条件是 0 至 $m$ 阶导数值的 Hermite 插值就是 Taylor 展开.

![](https://cdn.duanyll.com/img/20230618174244.png)

![](https://cdn.duanyll.com/img/20230618174347.png)

![](https://cdn.duanyll.com/img/20230618174401.png)

![Hermite 插值的 Newton 差商型构造](https://cdn.duanyll.com/img/20230618174651.png)

直接把已知的 $n$ 次导数值替换掉多出的 $n$ 次差商(红色部分). 亦可以处理对不同插值节点指定了不同阶数的导数的情况, 见[作业题](/source/_posts/course/2023-4-28-Numeric-7.md#problem-3)

![形式上容易理解](https://cdn.duanyll.com/img/20230618175112.png)

### 样条插值

> 高次多项式插值有种种问题, 还是分段用低次多项式近似吧.

节点 $x_0,x_1,\cdots x_n$ 上的 $k$ 次样条满足

1. 在每个子区间 $[x_i,x_{i+1}]$ 上是 $k$ 次多项式
2. 在整个区间 $[x_0,x_n]$ 上 $k-1$ 次连续

零次样条插值即为分段常数函数, 一次样条为分段线性函数, 常用三次样条

![](https://cdn.duanyll.com/img/20230618180940.png)

![也可以用其他方式指定左右边界的二阶导数或一阶导数](https://cdn.duanyll.com/img/20230618180959.png)

![](https://cdn.duanyll.com/img/20230618181110.png)

## 数据拟合与最小二乘

数据拟合也是用基函数线性组合, 但不要求精确过每个点, 要求曲线到给定数据点的距离最小

![](https://cdn.duanyll.com/img/20230618201621.png)

![](https://cdn.duanyll.com/img/20230618201921.png)

求解最后的矩阵就能得到最小二乘拟合系数. 最后的矩阵可以写作

![超定线性方程组最小二乘法](https://cdn.duanyll.com/img/20230618202110.png)

### 法线方程

![最小二乘的几何解释](https://cdn.duanyll.com/img/20230618202341.png)

$$
A^\top Ax=A^\top b
$$

公式被称作法线方程, 是超定方程 $Ax=b$ 的最小二乘解

对于非线性问题的最小二乘拟合, 需要选取合适的基函数, 还可能需要取对数来线性化.

### QR 分解

直接使用法线方程计算最小二乘解数值不稳定. 可利用 QR 分解来求解.

![d 的下面部分与 x 无关, 则上面为 0 时模长最小](https://cdn.duanyll.com/img/20230618203106.png)

只需进行完全 QR 分解, 然后求解 

$$
Rx=Q^\top b
$$

## 数值微分

$$
f'(x)=\lim_{x^*\to x}\frac{f(x^*)-f(x)}{x^*-x}
$$

直接似是而非的去个小量 $h$ 来近似好了

- 前向差商
  $$
  \hat{f}'(x)=\frac{f(x+h)-f(x)}{h}
  $$
- 后向差商
  $$
  \hat{f}'(x)=\frac{f(x)-f(x-h)}{h}
  $$
- 中心差商
  $$
  \hat{f}'(x)=\frac{f(x+h)-f(x-h)}{2h}
  $$
- 二阶中心差商
  $$
  \begin{aligned}
    \hat{f}''(x)&=\frac{f'(x+h/2)-f'(x-h/2)}{h}\\
    &=\frac{f(x+h)-2f(x)+f(x-h)}{h^2}
  \end{aligned}
  $$

用多项式插值的导数近似函数的导数. 两点插值得到的就是前向 / 后向差商, 三点插值得到中心差商

### 误差分析

通过 Taylor 展开的 Lagrange 余项控制误差的范围. 正确的差商公式都是 Taylor 展开式的变形 (确定插值点, 可以通过 Taylor 展开得到唯一正确的差商公式, 以及余项).

![](https://cdn.duanyll.com/img/20230618210556.png)

由于数值计算误差的存在, $h$ 的选取不是越小越好

![](https://cdn.duanyll.com/img/20230618210655.png)

### Richardson 外推

对任何 $F$ 的 $n$ 阶近似 (不仅是数值导数问题)

$$
F=\hat F(h)+Ch^n+O(h^{n+1})
$$

都能再加一项缩减一半步长

$$
\tilde{F}(h)=\frac{2^n\hat{F}(\frac{h}{2})-\hat{F}(h)}{2^n-1}
$$

至少是 $F$ 的 $n+1$ 阶近似.

### 待定系数法

![](https://cdn.duanyll.com/img/20230618211735.png)

给定插值点, 可以通过 Taylor 展开得到唯一正确的差商公式, 以及余项. 插值点数量已知时, 为了让这个方程有唯一解, Taylor 公式展开的阶数是确定的, 余项的阶数也能确定了. 解线性方程组求出系数后再带回展开式, 可能余项的系数为 0, 这时差商公式会具有更高的阶数.

## 数值积分

### Newton-Cotes 积分

用插值函数的积分来近似原函数的积分, 积分节点等距的插值型数值积分称为 Newton-Cotes 积分. 在区间 $[a,b]$ 上积分, 记 $h=b-a$.

数值积分的代数精度, 指可以准确积分的多项式的最高阶数. 给定积分的插值结点, 可以根据插值结点数量确定至少具有的代数精度, 并列线性方程组解出唯一正确的积分系数.

![求至少具有 n 数值精度的系数](https://cdn.duanyll.com/img/20230618223958.png)

从插值误差 $(\ref{interplError})$ 推导积分误差, 使用积分均值定理, $f(x)$ 不变号时存在 $[a,b]$ 中一点 $c$

$$
\int_a^bf(x)g(x)\d x=f(c)\int_a^bg(x)\d x
$$

插值误差

$$
E(x)=\frac{1}{(n+1)!}\left|f^{(n+1)}(c(x))\prod_{i=0}^n(x-x_i)\right|
$$

$$
\int_a^bE(x)\d x=\frac{f^{(n+1)}(c)}{(n+1)!}\int_a^b\prod_{i=0}^n(x-x_i)\d x
$$

一般形式的 Newton-Cotes 积分

$$
\int_a^bf(x)\d x=\sum_{i=0}^nA_if(x_i)
$$

$n$ 为奇数时, Newton-Cotes 具有 $n$ 阶代数精度. $n$ 为偶数时, Newton-Cotes 具有 $n+1$ 阶代数精度.

- 梯形法则: 两点一次插值
  $$
  I(f)=\frac{h}{2}(f(a)+f(b))
  $$
  $$
  E(f)=-\frac{h^3}{12}f''(c)
  $$
- Simpson 法则: 三点二次插值
  $$
  I(f)=\frac{h}{6}\left(f(a)+4f(\frac{a+b}{2})+f(b)\right)
  $$
  $$
  E(f)=-\frac{h^5}{2880}f^{(4)}(c)
  $$
- 中心法则: 使用中点函数值
  $$
  I(f)=hf(\frac{a+b}{2})
  $$
  $$
  E(f)=-\frac{h^3}{24}f''(c)
  $$
- 三点开 Newton-Cotes 积分: 
  $$
  I(f)=\frac{2h}{3}f(\frac{3a+b}{4})-\frac{h}{3}f(\frac{a+b}{2})+\frac{2h}{3}f(\frac{a+3b}{4})
  $$
  $$
  E(f)=\frac{7h^5}{23040}f^{(4)}(c)
  $$

复合 Newton-Cotes 积分, 先把 $[a,b]$ 划分为 $m$ 个等距子区间, 记 $\Delta h=\frac{b-a}{m}$, $x_i=a+i\Delta h$ 再在每个子区间上应用 Newton-Cotes 积分, 避免高次插值的 Runge 现象. 对于子区间断点处的函数值, 计算时可以重复利用节约时间. 复合积分的误差, 将原来的 $h^n$ 项替换为 $(b-a)\Delta h^{n-1}$ 项.

- 复合中心法则
  $$
  I(f)=\Delta h\sum_{i=0}^{m-1}f\left(\frac{x_i+x_{i+1}}{2}\right)
  $$
- 复合梯形法则
  $$
  I(f)=\frac{\Delta h}{2}\left(f(a)+f(b)+2\sum_{i=1}^{m-1}f(x_i)\right)
  $$
- 复合 Simpson 法则
  $$
  I(f)=\frac{\Delta h}{6}\left(f(a)+f(b)+2\sum_{i=1}^{m-1}f(x_i)+4\sum_{i=0}^{m-1}f\left(\frac{x_i+x_{i+1}}{2}\right)\right)
  $$

### Romberg 积分

用 Richardson 外推法提高复合梯形法则的精度.

![](https://cdn.duanyll.com/img/20230618223417.png)

$R_{j1}$ 是 $m=2^{j-1}$ 的复合梯形法则, 可递推计算, 补充新增的插值点. 

![](https://cdn.duanyll.com/img/20230618223647.png)

$R_{j2}$ 实际上是复合 Simpson 法则.

![伪代码](https://cdn.duanyll.com/img/20230618223746.png)

### Gauss 积分

非均匀地选取插值结点, 使积分值具有尽可能高的数值精度. 可通过正交基构造.

![](https://cdn.duanyll.com/img/20230618224440.png)

![](https://cdn.duanyll.com/img/20230618224530.png)

![](https://cdn.duanyll.com/img/20230618224632.png)

找到 $n+1$ 次多项式与 $n$ 次多项式正交, 用他的根做插值结点就能达到 $2n+1$ 阶代数精度.

![](https://cdn.duanyll.com/img/20230618224558.png)

![](https://cdn.duanyll.com/img/20230618224709.png)

Legendre 多项式是合适的构造.

![标准区间上的 Gauss 插值节点](https://cdn.duanyll.com/img/20230618224854.png)

定义映射

$$
t=\frac{2(x-\frac{b+a}{2})}{b-a}
$$

把 $[a,b]$ 映射到标准区间

$$
\int_a^bf(x)\d x=\frac{b-a}{2}\int_{-1}^1f\left(\frac{b-a}{2}t+\frac{b+a}{2}\right)\d t
$$